<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SearchPage</title>
    <link rel="stylesheet" href="/static/css/wrapper.css" />
    <script src="http://apps.bdimg.com/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="editorSection">
                <div class="pannel">
                    <div class="pannelHeader"><h2>搜索框</h2></div>
                    <div class="pannelBody">
                            <form id="post-form">
                                {% csrf_token %}
                                <p><input type="text" id="words" name="words" value="掠"></p>
                                <p style="color: #D94A38;font-size: 4px">*务必输入合法有效的动词或成语</p>
                                <p><button type="button" id='submit'>提交</button></p>
                            </form>
                    </div>
                </div>
            </div>
            <div class="editorTools">
                <div class="pannel">
                    <div class="pannelHeader header_2"></div>
                    <div class="pannelBody">
                        <div id="idioms"></div>
                        <div id="novels"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script type="text/javascript">
    $("#submit").click(function () {
            $.ajax({
                url: "{% url 'search' %}",
                type: "POST",
                data: $("#post-form").serialize(),
                success: function (data) {
                    $(".header_2").html("<h2>搜索结果</h2>");
                    $("#idioms").html("");
                    $("#novels").html("");
                    $("br").remove();
                    var idioms=data["idioms"];
                    var novels=data["novels"];
                    if (idioms.constructor === String){
                        if (idioms){
                            var ul=$("<ul></ul>").text(idioms);
                            $("#idioms").append(ul);
                        }
                    }
                    else{
                       $("#idioms").html("<h3>成语结果集</h3>");
                       $.each(idioms, function(key, value){
                           $("#idioms").append($("<h4></h4>").html(key));
                           var ul=$("<ul></ul>");
                           var li=ul.append($("<li></li>").text(value));
                           $("#idioms").append(li);
                         });
                       $("<br>").insertAfter("#idioms");
                    }
                    if (novels.constructor === Array){
                        for (var i = novels.length - 1; i >= 0; i--) {
                            $.each(novels[i], function(key, value){
                                $("#novels").append($("<h3></h3>").text("小说-"+key));
                                var x=Math.floor(Math.random()*1000);
                                $.each(value,function (k,v) {
                                    for (var y = v.length - 1; y>= 0; y--,x--){
                                        $("#novels").append($("<div></div>").text(k));
                                        var ul=$("<ul></ul>");
                                        var m="novels_i_"+x.toString()+"_y"+y.toString();
                                        var n="novels_i_"+y.toString()+"_x"+x.toString();
                                        var li=ul.append($("<li></li>").html(v[y]).addClass(m));
                                        $("#novels").append(li.append(toggler(m,n)));
                                        var clipboard = new ClipboardJS((".")+n.toString());
                                        clipboard.on('error', function(e) {
                                                            console.log(e);
                                                        });
                                }
                            });
                            $("<br>").insertAfter("#novels");
                            })
                        }}
                   else {
                        var ul=$("<ul></ul>");
                        $("#novels").append(ul.text(novels));
                    }
                }
                })
            })
</script>
<script>
    function toggler(m,n) {
        var button=$('<button>复制</button>').
            attr("data-clipboard-target",(".")+m.toString());
        return button.on("click",function () {
                $(this).addClass(n)
            })
    }
</script>
</html>